---
title: 从配置文件认识rollup
tags:
  - rollup
categories:
  - 构建工具
cover: 'https://www.rollupjs.com/img/twitter-card.jpg'
excerpt: 使用 rollup 开发 vue3 组件库，rollup 的配置和使用
date: 2020-12-17 00:00:00
link:
---

<h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><ul><li><code>npm init -y</code></li><li><code>cnpm i -D rollup</code></li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>rollup.config.dev.js</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> rollupResolve = <span class="built_in">require</span>(<span class="string">'rollup-plugin-node-resolve'</span>)</span><br><span class="line"><span class="keyword">const</span> rollupCommonjs = <span class="built_in">require</span>(<span class="string">'rollup-plugin-commonjs'</span>)</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">'rollup-plugin-babel'</span>)</span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">require</span>(<span class="string">'rollup-plugin-json'</span>)</span><br><span class="line"><span class="keyword">const</span> vue = <span class="built_in">require</span>(<span class="string">'rollup-plugin-vue'</span>)</span><br><span class="line"><span class="keyword">const</span> postcss = <span class="built_in">require</span>(<span class="string">'rollup-plugin-postcss'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">dir</span> =&gt;</span> path.resolve(__dirname, dir)</span><br><span class="line"><span class="keyword">const</span> inputPath = resolve(<span class="string">'./src/index.js'</span>)</span><br><span class="line"><span class="keyword">const</span> outputUmdPath = resolve(<span class="string">'./dist/cxvh.datav.js'</span>)</span><br><span class="line"><span class="keyword">const</span> outputEsmPath = resolve(<span class="string">'./dist/cxvh.datav.esm.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = {</span><br><span class="line">  input: inputPath,</span><br><span class="line">  output: [</span><br><span class="line">    {</span><br><span class="line">      file: outputUmdPath,</span><br><span class="line">      format: <span class="string">'umd'</span>,</span><br><span class="line">      name: <span class="string">'cxvhDatav'</span>,</span><br><span class="line">      globals: {</span><br><span class="line">        vue: <span class="string">"Vue"</span></span><br><span class="line">      }</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      file: outputEsmPath,</span><br><span class="line">      format: <span class="string">'esm'</span>,</span><br><span class="line">      globals: {</span><br><span class="line">        vue: <span class="string">"Vue"</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  ],</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">    rollupResolve(),</span><br><span class="line">    rollupCommonjs(),</span><br><span class="line">    babel({</span><br><span class="line">      exclude: <span class="string">'node_modules/**'</span></span><br><span class="line">    }),</span><br><span class="line">    postcss({</span><br><span class="line">      plugins: []</span><br><span class="line">    })</span><br><span class="line">  ],</span><br><span class="line">  external: [</span><br><span class="line">    <span class="string">"vue"</span></span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>rollup.config.prod.js</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> { terser } = <span class="built_in">require</span>(<span class="string">'rollup-plugin-terser'</span>)</span><br><span class="line">plugins: [</span><br><span class="line">  terser() <span class="comment">// 压缩js</span></span><br><span class="line">],</span><br></pre></td></tr></tbody></table></figure><h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><p>rollup -c rollup.config.prod.js<br>rollup -wc rollup.config.dev.js</p>